# Personal Serverless TODO

Welcome to your new personal TODO application using Serverless infrastructure from AWS! 

# Functionality of the application

This application allows creating/removing/updating and fetching personal TODO items, as well as generating email reminders for overdue and incomplete TODO items. TODO items may also optionally have an attachment image. User authentication is handled by Auth0, so users only have access to TODO items that they have created.

Additional background features include fuzzy full-text searching of Todos using AWS Elastic/Opensearch and s3 notifications for uploaded image files via websocket connections for active users.


# TODO items

Each TODO item contains the following fields:

* `userId` (string) - user id provided by Auth0
* `todoId` (string) - a unique id for an item
* `createdAt` (string) - date and time when an item was created
* `name` (string) - name of a TODO item (e.g. "Change a light bulb")
* `dueDate` (string) - date and time by which an item should be completed
* `done` (boolean) - true if an item was completed, false otherwise
* `attachmentUrl` (string) (optional) - a URL pointing to an image attached to a TODO item
* `userEmail` (string) - user email address extracted from the Java Web id Token generated by Auth0

**IMPORTANT**
The user email must be registered with AWS Simple Email Service for email reminders to be sent

## Prerequisites

Please ensure the following prerequisites are filled in order to start using this TODO application:

* Create a <a href="https://manage.auth0.com/" target="_blank">Auth0 account</a> for a single page application
  * Set Callback URLs: `http://localhost:3000/callback/`
  * Set Allowed Web Origins: `http://localhost:3000`
  * Set Allowed Origins (CORS): `http://localhost:3000, http://localhost:3000/callback` 

* Create a <a href="https://github.com" target="_blank">GitHub account</a> for storing your repository
* Installing <a href="https://nodejs.org/en/download/package-manager/" target="_blank">NodeJS</a> version up to 12.xx 
* Serverless 
   * Create a <a href="https://dashboard.serverless.com/" target="_blank">Serverless account</a> user
   * Install the Serverless Frameworkâ€™s CLI  (up to VERSION=2.21.1). Refer to the <a href="https://www.serverless.com/framework/docs/getting-started/" target="_blank">official documentation</a> for more help.
   ```bash
   npm install -g serverless@2.21.1
   serverless --version
   ```
   * Login and configure serverless to use the AWS credentials 
   ```bash
   # Login to your dashboard from the CLI. It will ask to open your browser and finish the process.
   serverless login
   # Configure serverless to use the AWS credentials to deploy the application
   # You need to have a pair of Access key (YOUR_ACCESS_KEY_ID and YOUR_SECRET_KEY) of an IAM user with Admin access permissions
   sls config credentials --provider aws --key YOUR_ACCESS_KEY_ID --secret YOUR_SECRET_KEY --profile serverless
   ```
   

# Frontend

The `client` folder contains a React web application that interacts with the Serverless TODO API. Once the API is deployed, the apiId and region in the `config.ts` file needs to updated, as well as the Domain and Client id from Auth0:


```ts
const apiId = '...' API Gateway id
export const apiEndpoint = `https://${apiId}.execute-api.${region}.amazonaws.com/dev`

export const authConfig = {
  domain: '...',    // Domain from Auth0
  clientId: '...',  // Client id from an Auth0 application
  callbackUrl: 'http://localhost:3000/callback'
}
```

# How to run the application

## Backend

To deploy an application run the following commands:

```
cd backend
npm install
sls deploy -v
```

## Frontend

To run a client application first edit the `client/src/config.ts` file to set correct parameters. And then run the following commands:

```
cd client
npm install
npm run start
```

This should start a development server with the React application that will interact with the serverless TODO application.

# Postman collection

An alternative way to test the API, you can use the Postman collection that contains sample requests. You can find a Postman collection in this project. To import this collection, do the following.

Click on the import button:

![Alt text](images/import-collection-1.png?raw=true "Image 1")


Click on the "Choose Files":

![Alt text](images/import-collection-2.png?raw=true "Image 2")


Select a file to import:

![Alt text](images/import-collection-3.png?raw=true "Image 3")


Right click on the imported collection to set variables for the collection:

![Alt text](images/import-collection-4.png?raw=true "Image 4")

Provide variables for the collection (similarly to how this was done in the course):

![Alt text](images/import-collection-5.png?raw=true "Image 5")



